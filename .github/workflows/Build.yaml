name: Build mwan3 IPK for ImmortalWrt 24.10

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Build mwan3 Package
        uses: immortalwrt/gh-action-sdk@master
        env:
          ARCH: mipsel_24kc
          PACKAGES: mwan3 luci-app-mwan3 iptables-nft ip6tables-nft kmod-ipt-nat kmod-ipt-conntrack-extra kmod-nf-nat6 kmod-nf-conntrack6
          EXTRA_FEEDS: src-git packages https://github.com/immortalwrt/packages.git src-git luci https://github.com/immortalwrt/luci.git
          V: s
          BUILD_LOG: 1

      - name: Upload IPK Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: mwan3-ipks-mipsel_24kc
          path: bin/packages/mipsel_24kc/packages/*.ipk
